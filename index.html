<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶≤‡¶ï‡ßç‡¶∑‡ßç‡¶Æ‡ßÄ‡¶™‡ßÅ‡¶∞ ‡¶´‡ßç‡¶∞‡¶ø ‡¶á‡¶´‡¶§‡¶æ‡¶∞ ‡¶ì ‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡¶∞ ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∏‡ßç‡¶§‡ßá ‡¶ñ‡¶æ‡¶®‡¶æ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶∞ | Google Maps</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>tailwind.config = { darkMode: 'class' }</script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;500;700&display=swap');
        body { font-family: 'Hind Siliguri', sans-serif; transition: 0.3s; overflow-x: hidden; }
        #main-map { height: 350px; width: 100%; border-bottom: 4px solid #059669; z-index: 10; }
        #mini-map { height: 220px; width: 100%; border-radius: 20px; margin-bottom: 15px; border: 2px solid #e5e7eb; }
        .glass { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); }
        .dark .glass { background: rgba(31, 41, 55, 0.85); }
        #preloader { position: fixed; inset: 0; background: white; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .dark #preloader { background: #111827; color: white; }
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        .animate-marquee { display: inline-block; animation: marquee 20s linear infinite; }
        .post-card { transition: 0.3s; border-radius: 28px; border: 1px solid rgba(0,0,0,0.05); }
    </style>
</head>
<body class="bg-green-50 dark:bg-gray-900 dark:text-gray-100 pb-40">

    <div id="preloader">
        <lottie-player src="https://assets2.lottiefiles.com/packages/lf20_m6cuL6.json" background="transparent" speed="1.5" style="width: 180px;" loop autoplay></lottie-player>
        <p class="text-green-600 font-bold mt-4 animate-pulse text-xl">‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
    </div>

    <div class="bg-stone-900 text-white py-3 px-4 flex justify-between items-center sticky top-0 z-[60]">
        <div class="text-[10px] font-bold text-green-400" id="countdown">‡¶á‡¶´‡¶§‡¶æ‡¶∞‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ï‡¶ø: ‡¶ó‡¶£‡¶®‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
        <button onclick="toggleDarkMode()" class="text-green-400 text-lg"><i class="fa-solid fa-circle-half-stroke"></i></button>
    </div>

    <div class="bg-green-600 text-white text-[10px] py-1 font-bold overflow-hidden border-b border-green-700">
        <div class="animate-marquee whitespace-nowrap">
            üåô ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá "‡¶∞‡¶æ‡¶∏‡ßç‡¶§‡¶æ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®" ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ö‡¶æ‡¶™ ‡¶¶‡¶ø‡¶≤‡ßá ‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶™‡¶• ‡¶¶‡ßá‡¶ñ‡¶ø‡ßü‡ßá ‡¶®‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§
        </div>
    </div>

    <div id="main-map"></div>

    <header class="py-6 px-4 text-center glass border-b dark:border-gray-700 sticky top-[44px] z-50 shadow-sm">
        <h1 class="text-xl font-black text-green-700 tracking-tighter leading-tight">‡¶≤‡¶ï‡ßç‡¶∑‡ßç‡¶Æ‡ßÄ‡¶™‡ßÅ‡¶∞ ‡¶´‡ßç‡¶∞‡¶ø ‡¶á‡¶´‡¶§‡¶æ‡¶∞ ‡¶ì ‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡¶∞ ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∏‡ßç‡¶§‡ßá ‡¶ñ‡¶æ‡¶®‡¶æ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶∞ ü•ß</h1>
        <div class="mt-2 inline-flex items-center gap-2 bg-green-100 dark:bg-gray-700 text-green-700 dark:text-green-400 px-4 py-1 rounded-full text-[10px] font-bold">
            <span id="active-count">‡ß¶</span>‡¶ü‡¶ø ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® (‡¶Ü‡¶ú)
            <span id="admin-badge" class="hidden ml-2 bg-red-500 text-white px-2 py-0.5 rounded text-[8px]">ADMIN MODE</span>
        </div>
    </header>

    <div class="max-w-md mx-auto px-4 mt-6 flex flex-col gap-3">
        <input id="search-input" oninput="applyFilters()" placeholder="‡¶∏‡¶æ‡¶∞‡ßç‡¶ö (‡¶è‡¶≤‡¶æ‡¶ï‡¶æ ‡¶¨‡¶æ ‡¶∏‡ßç‡¶•‡¶æ‡¶®)..." class="p-3 rounded-xl border dark:bg-gray-800 dark:border-gray-700 outline-none text-sm">
        <div class="flex gap-2">
            <select id="upazila-filter" onchange="applyFilters()" class="flex-1 p-3 rounded-xl border dark:bg-gray-800 dark:border-gray-700 text-sm font-bold bg-white dark:text-white outline-none">
                <option value="">‡¶∏‡¶ï‡¶≤ ‡¶â‡¶™‡¶ú‡ßá‡¶≤‡¶æ</option>
                <option value="‡¶∏‡¶¶‡¶∞">‡¶≤‡¶ï‡ßç‡¶∑‡ßç‡¶Æ‡ßÄ‡¶™‡ßÅ‡¶∞ ‡¶∏‡¶¶‡¶∞</option>
                <option value="‡¶∞‡¶æ‡¶Ø‡¶º‡¶™‡ßÅ‡¶∞">‡¶∞‡¶æ‡¶Ø‡¶º‡¶™‡ßÅ‡¶∞</option>
                <option value="‡¶∞‡¶æ‡¶Æ‡¶ó‡¶û‡ßç‡¶ú">‡¶∞‡¶æ‡¶Æ‡¶ó‡¶û‡ßç‡¶ú</option>
                <option value="‡¶∞‡¶æ‡¶Æ‡¶ó‡¶§‡¶ø">‡¶∞‡¶æ‡¶Æ‡¶ó‡¶§‡¶ø</option>
                <option value="‡¶ï‡¶Æ‡¶≤‡¶®‡¶ó‡¶∞">‡¶ï‡¶Æ‡¶≤‡¶®‡¶ó‡¶∞</option>
            </select>
            <select id="food-filter" onchange="applyFilters()" class="flex-1 p-3 rounded-xl border dark:bg-gray-800 dark:border-gray-700 text-sm font-bold bg-white dark:text-white outline-none">
                <option value="">‡¶∏‡¶¨ ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞</option>
                <option value="‡¶§‡ßá‡¶π‡¶æ‡¶∞‡¶ø">‡¶§‡ßá‡¶π‡¶æ‡¶∞‡¶ø</option>
                <option value="‡¶ï‡¶æ‡¶ö‡ßç‡¶ö‡¶ø">‡¶ï‡¶æ‡¶ö‡ßç‡¶ö‡¶ø</option>
                <option value="‡¶ö‡¶ø‡¶ï‡ßá‡¶® ‡¶¨‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶®‡¶ø">‡¶ö‡¶ø‡¶ï‡ßá‡¶® ‡¶¨‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶®‡¶ø</option>
                <option value="‡¶õ‡ßã‡¶≤‡¶æ ‡¶Æ‡ßÅ‡ßú‡¶ø">‡¶õ‡ßã‡¶≤‡¶æ ‡¶Æ‡ßÅ‡ßú‡¶ø</option>
                <option value="‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡¶∞ ‡¶ì‡ßü‡¶æ‡¶∏‡ßç‡¶§‡ßá ‡¶ñ‡¶æ‡¶®‡¶æ">‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡¶∞ ‡¶ì‡ßü‡¶æ‡¶∏‡ßç‡¶§‡ßá ‡¶ñ‡¶æ‡¶®‡¶æ</option>
            </select>
        </div>
    </div>

    <main id="post-container" class="max-w-md mx-auto px-4 mt-8 space-y-6"></main>

    <div class="max-w-md mx-auto px-4 mt-12 mb-20">
        <div class="bg-gradient-to-r from-green-600 to-green-500 text-white rounded-3xl p-6 text-center shadow-xl">
            <p class="text-[10px] uppercase font-bold opacity-80 mb-1">Developed By</p>
            <h2 id="dev-name" onclick="adminTrigger()" class="text-xl font-black mb-0 cursor-pointer select-none tracking-tight">Shahriar Naim Or Rashid</h2>
            <p class="text-[11px] font-bold opacity-90 mb-1">‡¶≤‡¶ï‡ßç‡¶∑‡ßç‡¶Æ‡ßÄ‡¶™‡ßÅ‡¶∞‡¶¨‡¶æ‡¶∏‡ßÄ‡¶∞ ‡¶∏‡ßá‡¶¨‡¶æ‡ßü ‡¶®‡¶ø‡ßü‡ßã‡¶ú‡¶ø‡¶§</p>
            <div class="flex justify-center gap-6 text-2xl mt-4">
                <a href="https://www.facebook.com/shahriarnaimorrashid" target="_blank"><i class="fa-brands fa-facebook"></i></a>
                <a href="https://www.instagram.com/shahriarnaimurrashid/" target="_blank"><i class="fa-brands fa-instagram"></i></a>
            </div>
        </div>
    </div>

    <div class="fixed bottom-6 left-1/2 -translate-x-1/2 w-full max-w-md px-4 z-40">
        <button onclick="toggleForm()" class="w-full bg-green-600 text-white font-black py-4 rounded-3xl shadow-2xl flex items-center justify-center gap-3 border-4 border-white dark:border-gray-800">
            <i class="fa-solid fa-plus-circle"></i> ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
        </button>
    </div>

    <div id="add-form" class="hidden fixed inset-0 bg-black/80 backdrop-blur-md flex items-end justify-center z-[120]">
        <div class="bg-white dark:bg-gray-800 w-full max-w-md p-6 rounded-t-[3rem] shadow-2xl overflow-y-auto max-h-[95vh]">
            <h2 class="text-xl font-bold mb-4 text-green-600 text-center">‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ï‡¶∞‡ßÅ‡¶® üìù</h2>
            <div id="mini-map"></div>
            <input id="target-date" type="date" class="w-full p-4 bg-gray-100 dark:bg-gray-700 rounded-2xl mb-3 border outline-none font-bold text-green-600">
            <input id="user-name" type="text" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ" class="w-full p-4 bg-gray-100 dark:bg-gray-700 rounded-2xl mb-3 border outline-none">
            <select id="upazila-name" class="w-full p-4 bg-gray-100 dark:bg-gray-700 rounded-2xl mb-3 border outline-none font-bold">
                <option value="‡¶∏‡¶¶‡¶∞">‡¶≤‡¶ï‡ßç‡¶∑‡ßç‡¶Æ‡ßÄ‡¶™‡ßÅ‡¶∞ ‡¶∏‡¶¶‡¶∞</option>
                <option value="‡¶∞‡¶æ‡¶Ø‡¶º‡¶™‡ßÅ‡¶∞">‡¶∞‡¶æ‡¶Ø‡¶º‡¶™‡ßÅ‡¶∞</option>
                <option value="‡¶∞‡¶æ‡¶Æ‡¶ó‡¶û‡ßç‡¶ú">‡¶∞‡¶æ‡¶Æ‡¶ó‡¶û‡ßç‡¶ú</option>
                <option value="‡¶∞‡¶æ‡¶Æ‡¶ó‡¶§‡¶ø">‡¶∞‡¶æ‡¶Æ‡¶ó‡¶§‡¶ø</option>
                <option value="‡¶ï‡¶Æ‡¶≤‡¶®‡¶ó‡¶∞">‡¶ï‡¶Æ‡¶≤‡¶®‡¶ó‡¶∞</option>
            </select>
            <input id="loc-name" type="text" placeholder="‡¶è‡¶≤‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ" class="w-full p-4 bg-gray-100 dark:bg-gray-700 rounded-2xl mb-3 border outline-none">
            <input id="mosque-name" type="text" placeholder="‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶ ‡¶¨‡¶æ ‡¶¨‡¶æ‡ßú‡¶ø‡¶∞ ‡¶®‡¶æ‡¶Æ" class="w-full p-4 bg-gray-100 dark:bg-gray-700 rounded-2xl mb-3 border outline-none">
            <select id="food-type" onchange="updateFormLabels()" class="w-full p-4 bg-gray-100 dark:bg-gray-700 rounded-2xl mb-3 border outline-none font-bold text-green-600">
                <option value="‡¶§‡ßá‡¶π‡¶æ‡¶∞‡¶ø">‡¶§‡ßá‡¶π‡¶æ‡¶∞‡¶ø</option>
                <option value="‡¶ï‡¶æ‡¶ö‡ßç‡¶ö‡¶ø">‡¶ï‡¶æ‡¶ö‡ßç‡¶ö‡¶ø ‡¶¨‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶®‡¶ø</option>
                <option value="‡¶ö‡¶ø‡¶ï‡ßá‡¶® ‡¶¨‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶®‡¶ø">‡¶ö‡¶ø‡¶ï‡ßá‡¶® ‡¶¨‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶®‡¶ø</option>
                <option value="‡¶õ‡ßã‡¶≤‡¶æ ‡¶Æ‡ßÅ‡ßú‡¶ø">‡¶õ‡ßã‡¶≤‡¶æ ‡¶Æ‡ßÅ‡ßú‡¶ø</option>
                <option value="‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡¶∞ ‡¶ì‡ßü‡¶æ‡¶∏‡ßç‡¶§‡ßá ‡¶ñ‡¶æ‡¶®‡¶æ">‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡¶∞ ‡¶ì‡ßü‡¶æ‡¶∏‡ßç‡¶§‡ßá ‡¶ñ‡¶æ‡¶®‡¶æ</option>
            </select>
            <textarea id="loc-desc" placeholder="‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£..." class="w-full p-4 bg-gray-100 dark:bg-gray-700 rounded-2xl mb-6 border outline-none h-20"></textarea>
            <div class="flex gap-4">
                <button onclick="toggleForm()" class="flex-1 font-bold text-gray-400">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                <button onclick="saveData()" id="submit-btn" class="flex-[2] bg-green-600 text-white py-4 rounded-2xl font-black">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </div>
    </div>

    <script>
        const DB_URL = "https://cumilla-biriyani-default-rtdb.asia-southeast1.firebasedatabase.app/lakshmipur_posts";
        let mainMap, miniMap, markersLayer, miniMarker, selectedCoords = null;
        let userCoords = { lat: 22.9447, lon: 90.8411 }, allPosts = [];
        let myPosts = JSON.parse(localStorage.getItem('my_lak_posts') || '[]');
        let isAdmin = false, clickCount = 0;

        const googleStreetUrl = 'https://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}';

        function init() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('target-date').value = today;
            document.getElementById('target-date').min = today;
            mainMap = L.map('main-map', { zoomControl: false }).setView([userCoords.lat, userCoords.lon], 12);
            L.tileLayer(googleStreetUrl, { subdomains:['mt0','mt1','mt2','mt3'], attribution: 'Google Maps' }).addTo(mainMap);
            markersLayer = L.layerGroup().addTo(mainMap);
            miniMap = L.map('mini-map', { zoomControl: false }).setView([userCoords.lat, userCoords.lon], 13);
            L.tileLayer(googleStreetUrl, { subdomains:['mt0','mt1','mt2','mt3'], attribution: 'Google Maps' }).addTo(miniMap);
            miniMap.on('click', function(e) {
                selectedCoords = { lat: e.latlng.lat, lon: e.latlng.lng };
                if(miniMarker) miniMap.removeLayer(miniMarker);
                miniMarker = L.marker([e.latlng.lat, e.latlng.lng]).addTo(miniMap);
            });
            fetchData(); startTimer();
        }

        function adminTrigger() {
            clickCount++;
            if(clickCount >= 5) {
                const pass = prompt("Admin Password ‡¶¶‡¶ø‡¶®:");
                if(pass === "audi3122") {
                    isAdmin = true;
                    document.getElementById('admin-badge').classList.remove('hidden');
                    alert("Admin Mode On! ‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§");
                    renderUI(allPosts);
                } else { alert("‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°!"); }
                clickCount = 0;
            }
            setTimeout(() => { clickCount = 0; }, 3000);
        }

        function startTimer() {
            setInterval(() => {
                const now = new Date(); const iftar = new Date(); iftar.setHours(18, 12, 0); 
                let diff = iftar - now; if (diff < 0) { iftar.setDate(iftar.getDate() + 1); diff = iftar - now; }
                const h = Math.floor(diff / (1000 * 60 * 60));
                const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const s = Math.floor((diff % (1000 * 60)) / 1000);
                document.getElementById('countdown').innerText = `‡¶á‡¶´‡¶§‡¶æ‡¶∞‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ï‡¶ø: ${h.toLocaleString('bn-BD')} ‡¶ò‡¶£‡ßç‡¶ü‡¶æ ${m.toLocaleString('bn-BD')} ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ${s.toLocaleString('bn-BD')} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°`;
            }, 1000);
        }

        async function fetchData() {
            try {
                const res = await fetch(`${DB_URL}.json`);
                const data = await res.json();
                const todayStr = new Date().toISOString().split('T')[0];
                if (data) {
                    allPosts = Object.keys(data).map(id => ({ id, ...data[id] }))
                        .filter(post => {
                            if (post.targetDate < todayStr) { fetch(`${DB_URL}/${post.id}.json`, { method: 'DELETE' }); return false; }
                            return true;
                        }).reverse();
                } else { allPosts = []; }
                applyFilters(); document.getElementById('preloader').style.display = 'none';
            } catch (e) { document.getElementById('preloader').style.display = 'none'; }
        }

        function applyFilters() {
            const s = document.getElementById('search-input').value.toLowerCase();
            const f = document.getElementById('food-filter').value;
            const u = document.getElementById('upazila-filter').value;
            const todayStr = new Date().toISOString().split('T')[0];
            const filtered = allPosts.filter(p => 
                p.targetDate === todayStr && 
                (p.location.toLowerCase().includes(s) || p.mosqueName.toLowerCase().includes(s)) &&
                (f === "" || p.foodType === f) && (u === "" || p.upazila === u)
            );
            renderUI(filtered);
        }

        function renderUI(posts) {
            const container = document.getElementById('post-container');
            container.innerHTML = ""; markersLayer.clearLayers();
            document.getElementById('active-count').innerText = posts.length.toLocaleString('bn-BD');
            posts.forEach(post => {
                const showDelete = myPosts.includes(post.id) || isAdmin;
                const icon = post.foodType === "‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡¶∞ ‡¶ì‡ßü‡¶æ‡¶∏‡ßç‡¶§‡ßá ‡¶ñ‡¶æ‡¶®‡¶æ" ? 'üè†' : (post.foodType === "‡¶õ‡ßã‡¶≤‡¶æ ‡¶Æ‡ßÅ‡ßú‡¶ø" ? 'ü•£' : 'üçõ');
                const directionUrl = `https://www.google.com/maps/dir/?api=1&destination=${post.lat},${post.lon}`;
                if(post.lat && post.lon) {
                    const marker = L.marker([post.lat, post.lon], { 
                        icon: L.divIcon({ className: '', html: `<div style="font-size:28px;">${icon}</div>`, iconSize: [35, 35]}) 
                    }).addTo(markersLayer);
                    marker.bindPopup(`<div style="text-align:center;"><b style="color:#059669;">${post.mosqueName}</b><br><a href="${directionUrl}" target="_blank" style="background:#059669; color:white; padding:4px 8px; border-radius:5px; text-decoration:none; font-size:10px; display:inline-block; margin-top:5px;">‡¶∞‡¶æ‡¶∏‡ßç‡¶§‡¶æ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</a></div>`);
                }
                container.innerHTML += `
                    <div class="bg-white dark:bg-gray-800 p-6 post-card shadow-sm dark:border-gray-700 relative border-l-4 border-green-500">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[9px] bg-green-100 text-green-700 px-2 py-0.5 rounded-md font-bold uppercase tracking-widest">Live</span>
                            ${showDelete ? `<button onclick="deletePost('${post.id}')" class="text-red-500 text-xs"><i class="fa-solid fa-trash"></i></button>` : ''}
                        </div>
                        <h3 class="text-xl font-black">üìç ${post.location}</h3>
                        <p class="text-green-600 font-bold text-sm mb-1">${post.mosqueName}</p>
                        <p class="text-gray-500 text-xs mb-4">${post.description || ''}</p>
                        <div class="flex justify-between items-center border-t pt-4">
                            <span class="bg-stone-100 dark:bg-gray-700 text-stone-600 dark:text-gray-300 px-3 py-1 rounded-full text-[10px] font-bold">${post.foodType}</span>
                            <a href="${directionUrl}" target="_blank" class="flex items-center gap-1.5 text-blue-600 font-bold text-xs bg-blue-50 px-3 py-1.5 rounded-xl">
                                <i class="fa-solid fa-location-arrow"></i> ‡¶∞‡¶æ‡¶∏‡ßç‡¶§‡¶æ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
                            </a>
                        </div>
                    </div>
                `;
            });
        }

        async function saveData() {
            if(!selectedCoords) return alert("‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶¶‡¶ø‡¶®!");
            const payload = {
                targetDate: document.getElementById('target-date').value,
                userName: document.getElementById('user-name').value || "Anonymous",
                location: document.getElementById('loc-name').value,
                upazila: document.getElementById('upazila-name').value,
                mosqueName: document.getElementById('mosque-name').value,
                foodType: document.getElementById('food-type').value,
                description: document.getElementById('loc-desc').value,
                timestamp: Date.now(), lat: selectedCoords.lat, lon: selectedCoords.lon
            };
            if(!payload.location || !payload.mosqueName) return alert("‡¶§‡¶•‡ßç‡¶Ø ‡¶Ö‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£!");
            document.getElementById('submit-btn').innerText = "‡¶∏‡ßá‡¶≠ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
            const res = await fetch(`${DB_URL}.json`, { method: 'POST', body: JSON.stringify(payload) });
            const data = await res.json();
            myPosts.push(data.name);
            localStorage.setItem('my_lak_posts', JSON.stringify(myPosts));
            toggleForm(); fetchData();
            document.getElementById('submit-btn').innerText = "‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®";
        }

        async function deletePost(id) {
            if(confirm("‡¶™‡ßã‡¶∏‡ßç‡¶ü‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) {
                await fetch(`${DB_URL}/${id}.json`, { method: 'DELETE' });
                myPosts = myPosts.filter(p => p !== id);
                localStorage.setItem('my_lak_posts', JSON.stringify(myPosts));
                fetchData();
            }
        }

        function updateFormLabels() {
            const type = document.getElementById('food-type').value;
            document.getElementById('mosque-name').placeholder = (type === "‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡¶∞ ‡¶ì‡ßü‡¶æ‡¶∏‡ßç‡¶§‡ßá ‡¶ñ‡¶æ‡¶®‡¶æ") ? "‡¶¨‡¶æ‡ßú‡¶ø‡¶∞ ‡¶®‡¶æ‡¶Æ" : "‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶ ‡¶¨‡¶æ ‡¶¨‡¶æ‡ßú‡¶ø‡¶∞ ‡¶®‡¶æ‡¶Æ";
        }

        function toggleForm() {
            const f = document.getElementById('add-form');
            f.classList.toggle('hidden');
            if(!f.classList.contains('hidden')) setTimeout(() => { miniMap.invalidateSize(); }, 300);
            else { if(miniMarker) miniMap.removeLayer(miniMarker); selectedCoords = null; }
        }

        function toggleDarkMode() { document.documentElement.classList.toggle('dark'); }
        window.onload = init;
    </script>
</body>
</html>
